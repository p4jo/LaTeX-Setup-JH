\RequirePackage{graphicx, hyperref}

\directlua{dofile("src/Collapsible.lua")}
\NewDocumentCommand\DeclareCollapsible{mm}{
    \directlua{DeclareCollapsible("#1","#2")}
}
\NewDocumentEnvironment{collapsible}{m +b}{ 
    \tl_set:Nx\l_envBody_tl{#2}
\directlua{collapsibleEnvironment("#1")}}{}

\NewDocumentCommand\collapseButton{m}{\includegraphics[width=1cm]{src/#1}}

\NewDocumentEnvironment{CollapsibleDocument}{+b}{
    \tl_set:Nn\l_entireDocument_tl{#2}
    \directlua{produceDocument()}
}{}