\RequirePackage{graphicx, hyperref}

\directlua{dofile("src/Collapsible.lua")}
\NewDocumentCommand\DeclareCollapsible{mm}{
    \directlua{DeclareCollapsible("#1","#2")}
}
\NewDocumentEnvironment{collapsible}{m +b}{ 
    \tl_set:Nn\collapsibleCurrentEnvironmentContent{#2}
    \directlua{collapsibleEnvironment("#1")}
}{}

\NewDocumentCommand\collapseButton{m}{toggle~#1\includegraphics[width=0.3cm]{src/#1}}

\NewDocumentEnvironment{CollapsibleDocument}{+b}{
    #1
}{
    \tl_set:Nn\collapsibleCurrentDocumentContent{#1}
    \directlua{produceExtraDocuments()}
}